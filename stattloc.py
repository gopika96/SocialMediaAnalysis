"""
Use Twitter API to grab user information from list of organizations; 
export text file
Uses Twython module to access Twitter API
"""

import sys
import string
import simplejson
from twython import Twython

#WE WILL USE THE VARIABLES DAY, MONTH, AND YEAR FOR OUR OUTPUT FILE NAME
import datetime
now = datetime.datetime.now()
day=int(now.day)
month=int(now.month)
year=int(now.year)


#FOR OAUTH AUTHENTICATION -- NEEDED TO ACCESS THE TWITTER API
t = Twython(app_key='tr1RZR9F6Mo5Rdi9czzpMXUux', #REPLACE 'APP_KEY' WITH YOUR APP KEY, ETC., IN THE NEXT 4 LINES
    app_secret='vpbeNjAaah90FF7bYg91k54dgBDhop7H2koryCRIZXdetmvnoU',
    oauth_token='4113262402-Ih4QHi3Sc5uvzyoxnsbSWwU91FzQMVhlLwH3smm',
    oauth_token_secret='FHNs7CYZuECtES57l8hvkk8IgBv5qOtxbDb384ddkb8Zw')
   
#REPLACE WITH YOUR LIST OF TWITTER USER IDS
ids = "4766768968,707187246705856512,730364025490542596,3016785216,3238926462,276528688,2439581820,4695543362,4078385837,544020718,722817994892701696,747221677927346176,744495234663362560,747027068706230273,2392856713,467673888,104369107,163715830,3235213548,3355388879,712169729583136769,2773234038,248999655,363951998,4135392070,130061946,833324984,197316305,384459955,3746727913,3127344898,281156706,586383707,2917707678,2879268883,3849567315,279681047,171418446,2922308096,2945316858,734774508268195840,3470097565,749497369071325184,633238859,2576569598,257730443,1691242688,4617422895,4567849576,4135158255,712086630870421504,96658841,734654067528597504,2912831797,141958229,711533146102169602,2995518422,742532706,707265229374279680,3049417952,100543834,122892598,45830303,524621795"
#ACCESS THE LOOKUP_USER METHOD OF THE TWITTER API -- GRAB INFO ON UP TO 100 IDS WITH EACH API CALL
#THE VARIABLE USERS IS A JSON FILE WITH DATA ON THE 32 TWITTER USERS LISTED ABOVE
users = t.lookup_user(user_id = ids)

#NAME OUR OUTPUT FILE - %i WILL BE REPLACED BY CURRENT MONTH, DAY, AND YEAR
outfn = "twitter_user_data_%i.%i.%i.txt" % (now.month, now.day, now.year)

#NAMES FOR HEADER ROW IN OUTPUT FILE
fields = "screen_name location ".split()

#INITIALIZE OUTPUT FILE AND WRITE HEADER ROW   
outfp = open('outfn.txt', "a")
outfp.write(string.join(fields, "\t") + "\n")  # header

#THE VARIABLE 'USERS' CONTAINS INFORMATION OF THE 32 TWITTER USER IDS LISTED ABOVE
#THIS BLOCK WILL LOOP OVER EACH OF THESE IDS, CREATE VARIABLES, AND OUTPUT TO FILE
for entry in users:
    #CREATE EMPTY DICTIONARY
    r = {}
    for f in fields:
        r[f] = ""
    #ASSIGN VALUE OF 'ID' FIELD IN JSON TO 'ID' FIELD IN OUR DICTIONARY
    r['location'] = entry['location']
    r['screen_name'] = entry['screen_name']
    #NOT EVERY ID WILL HAVE A 'URL' KEY, SO CHECK FOR ITS EXISTENCE WITH IF CLAUSE
    print r
    #CREATE EMPTY LIST
    lst = []
    #ADD DATA FOR EACH VARIABLE
    for f in fields:
        lst.append(unicode(r[f]).replace("\/", "/"))
    #WRITE ROW WITH DATA IN LIST
    outfp.write(string.join(lst, "\t").encode("utf-8") + "\n")

outfp.close()    
